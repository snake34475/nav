version: 2.1

orbs:
  node: circleci/node@4.1.0

jobs:
  test:
    executor:
      name: node/default
      tag: 14.18.1-buster
    steps:
      - checkout
      - node/install-packages
      - run: npm install
      - run: npm serve
  build:
    executor:
      name: node/default
      tag: 14.18.1-buster
    steps:
      - checkout
      - node/install-packages
      - run: npm install
      - run: npm run build
      - persist_to_workspace:
          root: /app
          paths:
            - dist
  deploy:
    machine: true
    steps:
      - attach_workspace:
          at: /app
      - run: scp -r dist/ root@http://81.68.128.43:8888/:/www/wwwroot/nav.onestyle.top
